# **数据库相关**

## 常见的数据库优化手段索引的优缺点

​		常见的优化手段有：

​			1、在编写SQL语句时不使用*，而是使用字段名，哪怕每一个字段名都写上去，

​			2、添加索引，使查询效率变高，尤其是在where条件中的字段

​			3、尽量不要在列上进行运算（函数操作和表达式操作）否则索引失效

​			4、不使用not in  和 <>   以及！=否则索引失效

​			5、在使用like语句时不要以%开头否则索引失效

​			6、多表联查时多使用小表作为驱动表，因为（驱动表必须全表查询）

​			

## 什么字段上建立索引数据库

​			1、在作为where条件出现较多的表



​			2、尽量建立索引时将顺序排好的字段（否则查询时中间一个字段没有用上后面的都用不上）

​			

​			3、尽量选择一些和其他表有关联的字段，如订单表的用户字段

## 你们数据库的高可用架构是怎么样的？

​		一般来说数据库的备份我们采用主从复制（注：单纯的主从并不是高性能或者高可用的），而为了提高性能我们在主从之后会使用Mycat进行读写分离，但是他也只是做到了高性能并没有做到高可用，那么如何做到高可用呢，就是我们使用KeepAlive进行虚拟化ip，如果使用简单的高可用加高性能那么我们就直接通过KeepAlive，去连接主机然后再进行访问，如果主机挂掉了就直接使用丛机进行读写，等恢复主机之后将主机变为丛机，读取丛机的数据，或者恢复后同步数据，再使用指向主机，下面分别是高可用和一个高性能可用的架构图

​		![](C:/Users/topcom/Documents/Java%E4%BF%AE%E4%BB%99%E6%89%8B%E5%86%8C/Java_Manual/%E9%9D%A2%E8%AF%95/img/MySQL%E9%AB%98%E5%8F%AF%E7%94%A8.png)

![](C:/Users/topcom/Documents/Java%E4%BF%AE%E4%BB%99%E6%89%8B%E5%86%8C/Java_Manual/%E9%9D%A2%E8%AF%95/img/MySQL%E4%B8%BB%E4%BB%8E%E9%AB%98%E5%8F%AF%E7%94%A8.png)

## 如何保证数据库主从一致性？

​		**方案一：忽略**

​				任何脱离业务的架构设计都是耍流氓，绝大部分业务，例如：百度搜索，淘宝订单，QQ消息，58帖子都允许短时间不一致。如果业务能接受，最推崇此法。别把系统架构搞得太复杂。

​		**方案二：选择性主读**

​				将哪个库，哪个表，哪个主键三个信息拼装一个key设置到cache里，这条记录的超时时间，设置为“主从同步时延” ，画外音：key的格式为“db:table:PK”，假设主从延时为1s，这个key的cache超时时间也为1s。 这是要读哪个库，哪个表，哪个主键的数据呢，也将这三个信息拼装一个key，到cache里去查询， 在cache里记录哪些记录发生过写请求，来路由读主还是读从 

## 为什么mongodb的索引用了B树，而mysql用B+树？

​		我们首先来看一下B树的结构

​			B树的特点就是每一层的节点数据非常多，而层数比较少，目的就是为了减少IO次数

​			B树的每个节点都是有data域的（指针），这无疑增大了节点大小

​		再来看一下B+树的结构

​			B+树的特点就是，B+树所有的Data域在叶子节点 ，非叶子节点存储索引数据

​			B+树只要遍历叶子节点就可以实现整棵树的遍历

## 用mysql过程中，有遇到什么问题么？

## 你们生产用的是哪种事务隔离级别，为什么？

## 什么情况下会造成索引失效？

​		1、使用or关键字，如果条件中有or，即使其中有条件带索引也不会使用 

​					注意：使用or，又想索引生效，只能将or条件中的每个列都加上索引 

​		2、索引顺序不一致，例如索引为（name，age，email），而查询时（name，email，age）则会造成只有name生效，其他两个字段用不到索引

​					注意：尽量避免索引顺序不一致，如果实在避免不了，在设计时就应先考虑顺序

​		3、以like %开头的关键字，如果以like %name查询，会使索引失效

​					注意：尽量使用 like name%这种，因为%号在后面还是能实用索引

​		4、如果列类型是字符串，那一定要在条件中将数据使用引号引用起来，否则不会使用索引 

​					注意：字符串类型列一定要使用引号（虽然情况很少）

​		5、 where语句中使用 <>和 !=   还有not  in，如果使用了不等于那么他会全表扫描

​					注意：尽量不要使用不等于或者not

​		6、 where语句中对字段表达式操作，例如where age * 2 = 100

​					注意：不要使用表达式，尽量使用age = 50